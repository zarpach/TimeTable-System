@using iuca.Application.Enums
@model StudyCardCoursesViewModel

@{
    int num = 0;
    bool electiveSelected = false;
    if (Model != null)
    {
        electiveSelected = Model.StudyCardCourses.Any(x => x.State != enu_CourseState.Dropped && x.IsForAll && x.IsSelected);
        if (!electiveSelected)
            electiveSelected = Model.ElectiveCourses.Any(x => x.State != enu_CourseState.Dropped && x.IsSelected);
    }
}

<div id="ModalContainer"></div>

@if (Model != null)
{
    <div class="container">
        <div class="row pt-2 justify-content-end">
            <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
                <a asp-controller="StudentCourseRegistrations" asp-action="AddDropCourses" class="btn btn-primary btn-lg btn-block text-uppercase">
                     Продолжить &nbsp; <i class="fas fa-chevron-right"></i> </a>
            </div>
        </div>
        <hr/>
        <div class="row pt-2">
            <div class="col-12 p-0 text-center">
                <h4 class="text-uppercase">Выбор курсов из Study Card</h4>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-4">
                <h6 class="d-inline-block">Семестр (Semester): <span class="d-inline-block font-weight-bold">@(((enu_Season)Model.Semester.Season).GetDisplayName())</span></h6> 
            </div>
            <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-4 text-xl-center text-lg-center">
                <h6 class="d-inline-block">Год(Year): <span class="d-inline-block font-weight-bold">@Model.Semester.Year</span></h6> 
            </div>
            <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-4 text-lg-right text-xl-right">
                <h6 class="d-inline-block">Группа(Group) : <span class="d-inline-block font-weight-bold">@Model.DepartmentGroup.DepartmentCode</span></h6> 
            </div>
        </div>
        <hr>

        <div class="row pt-2">
            <div class="col-12">
                @if (Model.StudyCardCourses.Count > 0)
                {
                    foreach (var course in Model.StudyCardCourses)
                    {
                        num++;
                        <div class="row course-item @((course.IsSelected || course.State == enu_CourseState.Added) ? "regular-bg" : "")">
                            <div class="droppedRow col-12 bg-danger text-white" @(course.State != enu_CourseState.Dropped ? "style=display:none;" : "")>
                                <span>DROPPED</span>
                            </div>

                            <div class="addedRow col-12 bg-success text-white" @(course.State != enu_CourseState.Added ? "style=display:none;" : "")>
                                <span>ADDED</span>
                            </div>
                            @if (course.IsForAll)
                            {
                                <div class="col-12 p-0">
                                    <div class="alert alert-warning p-0">
                                        <h6 class="text-uppercase m-1 ml-3">IUCA Elective</h6>
                                    </div>
                                </div>
                            }
                            <div class="col-xl-10 col-lg-10 col-12">
                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-9 col-xl-9 mt-2">
                                        <span class="course-item-name">
                                            <b>@course.AnnouncementSection.Course.Abbreviation @course.AnnouncementSection.Course.Number</b>,
                                            @course.AnnouncementSection.Course.Name (@course.AnnouncementSection.Section)
                                            (<b>ID: @course.AnnouncementSection.Course.ImportCode</b>)
                                        </span>
                                        <br />
                                        @course.InstructorName
                                        <input type="hidden" name="registrationCourseId" value="@course.AnnouncementSection.Id" />
                                    </div>
                                    <div class="col-6 col-sm-6 col-md-6 col-lg-3 col-xl-3 mt-2">
                                        Кредитов: <span class="coursePts">@course.AnnouncementSection.Credits</span>
                                        <br />
                                        Время: @course.AnnouncementSection.Schedule
                                        <br />
                                        Мест осталось: <span class="placesText">@course.RestPlaces</span>
                                        <span class="queueText text-danger">
                                            @if (course.Queue > 0)
                                            {
                                                @string.Format("(очередь: {0})", course.Queue)
                                            }
                                        </span>
                                    </div>
                                    <div class="col-12 mt-2">
                                        Комментарий:
                                        <br />
                                        <span class="font-italic">@course.Comment</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-2 col-lg-2 col-12 mt-2 text-right">
                                <div class="row">
                                    <div class="d-xl-none d-lg-no col-6"></div>
                                    <div class="col-xl-12 col-lg-12 col-6">
                                        <input type="hidden" name="studentCourseRegistrationId" value="@Model.StudentCourseRegistrationId" />
                                        <input type="hidden" name="studyCardCourseId" value="@course.AnnouncementSection.Id" />

                                        <button class="btn btn-outline-primary btn-block text-uppercase @(course.IsForAll ? "forAllReturnBtn" : "")" name="btnReturn"
                                        @(course.State == enu_CourseState.Dropped ? "" : "hidden")>
                                            Undo
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase @(course.IsForAll ? "forAllRemoveBtn" : "")" name="btnRemove"
                                        @(course.State == enu_CourseState.Added ? "" : "hidden")>
                                            Remove
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase @(course.IsForAll ? "forAllDropBtn" : "")" name="btnDrop"
                                        @(course.IsSelected && course.State == enu_CourseState.Regular ? "" : "hidden")>
                                            Drop
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase @(course.IsForAll ? "forAllAddBtn" : "")" name="btnAdd"
                                        @(!course.IsSelected && course.State == enu_CourseState.Regular ? "" : "hidden") @(course.IsForAll && electiveSelected ? "disabled" : "")>
                                            Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>Нет курсов для выбора</p>
                }
            </div>
            <div class="col-12">
                @if (Model.DisplayIUCAElectives && Model.ElectiveCourses.Count > 0)
                {
                    <div class="row mt-3">
                        <div class="col-12 alert alert-primary text-center">
                            <h4 class="text-uppercase">IUCA electives</h4>
                        </div>
                    </div>
                    foreach (var course in Model.ElectiveCourses)
                    {
                        num++;
                        <div class="row course-item @(course.IsSelected ? "regular-bg" : "")">
                            <div class="droppedRow col-12 bg-danger text-white" @(course.State != enu_CourseState.Dropped ? "style=display:none;" : "")>
                                <span>DROPPED</span>
                            </div>

                            <div class="addedRow col-12 bg-success text-white" @(course.State != enu_CourseState.Added ? "style=display:none;" : "")>
                                <span>ADDED</span>
                            </div>
                            <div class="col-12 p-0">
                                <div class="alert alert-warning p-0">
                                    <h6 class="text-uppercase m-1 ml-3">IUCA Elective</h6>
                                </div>
                            </div>
                            <div class="col-12 col-sm-12 col-md-12 col-lg-8 col-xl-8 mt-2">
                                <span class="course-item-name">
                                    <b>@course.AnnouncementSection.Course.Abbreviation @course.AnnouncementSection.Course.Number</b>,
                                    @course.AnnouncementSection.Course.Name (@course.AnnouncementSection.Section)
                                    (<b>ID: @course.AnnouncementSection.Course.ImportCode</b>)
                                </span>
                                <br />
                                @course.InstructorName
                                <input type="hidden" name="registrationCourseId" value="@course.AnnouncementSection.Id" />
                            </div>
                            <div class="col-6 col-sm-6 col-md-6 col-lg-2 col-xl-2 mt-2">
                                Кредитов: <span class="coursePts">@course.AnnouncementSection.Credits</span>
                                <br>
                                Мест осталось: <span class="placesText">@course.RestPlaces</span>
                                <span class="queueText text-danger">
                                    @if (course.Queue > 0)
                                    {
                                        @string.Format("(очередь: {0})", course.Queue)
                                    }
                                </span>
                            </div>
                            <div class="col-12 col-sm-12 col-md-12 col-lg-2 col-xl-2 mt-2">
                                <div class="row">
                                    <div class="col-lg-0 col-xl-0 col-6"></div>
                                    <div class="col-lg-12 col-xl-12 col-6">
                                        <input type="hidden" name="studentCourseRegistrationId" value="@Model.StudentCourseRegistrationId" />
                                        <input type="hidden" name="studyCardCourseId" value="@course.AnnouncementSection.Id" />

                                        <button class="btn btn-outline-primary btn-block text-uppercase forAllReturnBtn" name="btnReturn"
                                        @(course.State == enu_CourseState.Dropped ? "" : "hidden") @(electiveSelected ? "disabled" : "")>
                                            Undo
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase forAllRemoveBtn" name="btnRemove"
                                        @(course.State == enu_CourseState.Added ? "" : "hidden")>
                                            Remove
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase forAllDropBtn" name="btnDrop"
                                        @(course.IsSelected && course.State == enu_CourseState.Regular ? "" : "hidden")>
                                            Drop
                                        </button>

                                        <button class="btn btn-outline-primary btn-block text-uppercase forAllAddBtn" name="btnAdd"
                                        @(!course.IsSelected && course.State == enu_CourseState.Regular ? "" : "hidden") @(electiveSelected ? "disabled" : "")>
                                            Add
                                        </button>

                                    </div>
                                </div>
                            </div>

                        </div>
                    }
                }
            </div>
        </div>
    </div>

}
else
{
    <div class="container">
        <div class="row pt-2 justify-content-end">
            <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
                <a asp-controller="StudentCourseRegistrations" asp-action="CourseRegistration" class="btn btn-primary btn-lg btn-block text-uppercase">
                     Продолжить &nbsp; <i class="fas fa-chevron-right"></i> </a>
            </div>
        </div>
        <hr/>
        <div class="row pt-2">
            <div class="col-12 p-0 text-center">
                <h4 class="text-uppercase text-danger">Study card не добавлен</h4>
            </div>
        </div>
    </div>
}


@section Scripts
{
    <script src="~/js/add-drop-select-courses-from-study-card.js" asp-append-version="true"></script>
}